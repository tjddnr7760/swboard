<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}" href="../static/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 560px;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="py-5 text-center">
        <h2>SW BOARD 로그인</h2>
    </div>
    <form id="loginForm">
        <div>
            <label for="email">ID</label>
            <input type="text" id="email" name="email" class="form-control" placeholder="이메일을 입력하세요">
        </div>
        <div>
            <label for="password">PW</label>
            <input type="password" id="password" name="password" class="form-control" placeholder="비밀번호를 입력하세요">
        </div>
        <hr class="my-4">
        <div class="row">
            <div class="col">
                <button class="w-100 btn btn-primary btn-lg" type="button" onclick="login()">LOGIN</button>
            </div>
        </div>
    </form>

    <script>
        function login() {
            var email = document.getElementById("email").value;
            var password = document.getElementById("password").value;

            var data = {
                email: email,
                password: password
            };

            fetch("/auth/login", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            })
            .then(response  => {
                const accessToken = response.headers.get("Authorization");
                const refreshToken = response.headers.get("Refresh");

                localStorage.setItem("accessToken", accessToken);
                localStorage.setItem("refreshToken", refreshToken);

                return fetch("/board/main/1", {
                    method: "GET",
                    headers: {
                        "Authorization": `Bearer ${accessToken}`
                    }
                });
            })
            .then(mainPageResponse => mainPageResponse.text())
            .then(html => {
                document.body.innerHTML = html;
                window.history.pushState({}, null, '/board/main/1');
                location.reload();
            })
            .catch(error => {
                console.error(error);
            });
        }
    </script>
</div> <!-- /container -->
</body>
</html>
